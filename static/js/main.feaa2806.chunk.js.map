{"version":3,"sources":["components/UserItem.js","components/UserList.js","components/ChatUi.js","components/hooks/useChatMessages.js","components/RenderMessage.js","components/WeChatSearch.js","components/Calendar.js","components/ImagesUi.js","components/SearchUi.js","components/WeChatDialog.js","App.js","index.js"],"names":["UserItem","props","_jsx","_Fragment","children","_jsxs","className","onClick","Avatar","src","size","alt","Text","truncate","name","text","date","_useState","useState","_useState2","_slicedToArray","filterText","setFilterText","_useState3","_useState4","users","setUsers","_useState5","_useState6","isLoading","setIsLoading","_useState7","_useState8","pageIndex","setpageIndex","_useState9","_useState10","hasMore","setHasMore","useEffect","fetchDate","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","wrap","_context","prev","next","axios","get","concat","sent","data","rows","length","prevData","_toConsumableArray","prevPage","t0","console","error","finish","stop","apply","arguments","userList","filter","element","index","array","nickname","includes","map","user","_info","img","localAvatar","talker","onClickMe","nanoid","Input","type","placeholder","onChange","style","height","overflow","Divider","plainp","plain","ChatUiBar","IconButton","icon","onClickBack","title","onClickMore","visibility","MessageBubble","isLeft","message","position","userMessageContent","useMemo","renderMessageContent","dateTime","dayjs","createdAt","format","Bubble","avatar","ChatMessageList","scrollHeightRef","useRef","scrollElementRef","current","scrollTop","scrollHeight","messages","id","InfiniteScroll","scrollableTarget","dataLength","inverse","scrollThreshold","onScroll","event","srcElement","atBottom","msg","ChatUi","moreVisibility","fetchMoreData","useChatMessages","initValue","setMessages","prependMsgs","preMsgs","appendMsgs","appMsgs","content","_id","Image","mediaSourcePath","mediaBCKPath","mediaPath","controls","Video","emojiInfo","cdnUrl","margin","SystemMessage","finalmsg","undefined","parser","parseString","result","refermsg","appmsg","displayname","reReferMsg","breakWord","log","WeChatSearch","info","createTime","_useChatMessages","setPageIndex","isHasMore","nextPageIndex","setNextPageIndex","itemRef","messageUrl","then","body","msgs","forEach","row","unshift","msgSvrId","Math","floor","random","isSend","userInfo","reserved2","conRemark","nickName","hasTime","catch","nextMessageUrl","push","prevMessageUrl","fetchData","_ref2","_yield$Promise$all","_yield$Promise$all2","prevResponse","nextResponse","nextData","Promise","all","elem","document","getElementById","currentNode","parentNode","scrollIntoView","extend","utc","timezone","tz","setDefault","CalendarBar","CalendarLoading","Spin","tip","CalendarChoose","messageDate","setMessageDate","isCalendarChoose","setIsCalendarChoose","createTimeRef","selectTimeRef","CalendarElement","Calendar","fullscreen","disabledDate","i","isSame","locale","validRange","defaultValue","onSelect","source","valueOf","ImagesUIBar","ImageItem","width","preview","loading","Icon","fn","ImagesUI","_ref3","setIsHasMore","mediaUrl","imgPath","endMessage","PreviewGroup","imageRender","originalNode","toolbarRender","onVisibleChange","visible","prevVisible","vid","getElementsByClassName","pause","FloatButton","BackTop","timeStampToDate","stamp","Date","year","getFullYear","month","getMonth","day","getDate","getHours","getMinutes","getSeconds","SearchBar","timer","clearTimeout","setTimeout","onChangeKeyWord","Button","onClickButton","SearchOption","Flex","center","disabled","UserItemList","items","setItems","isconcat","now","key","keyWord","total","itemlist","item","onClikItem","SearchUi","currentComponent","setCurrentComponent","setKeyWord","isSearchBar","setIsSearchBar","btn","SearchBarComponent","kw","renderComponent","WeChatDialog","isSearch","setIsSearch","App","isChat","setIsChat","setUserInfo","UserList","rootElement","ReactDOM","render","React","StrictMode"],"mappings":"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","file":"static/js/main.feaa2806.chunk.js","sourcesContent":["import React, { useState } from 'react';\nimport { Text, Avatar } from '@chatui/core';\nimport './useritem-theme.css'\n\n\nexport default function UserItem(props) {\n\treturn (<>\n\t<div className='userItem-Bar' onClick={()=>{props.onClick()}}>\n\t\t<div className='userItem-Avatar-div'>\n\t\t\t<Avatar className='userItem-Avatar' src={props.Avatar} size=\"lg\" alt='无法加载头像'/>\n\t\t</div>\n\t\t<div className='userItem-content'>\n\t\t\t<Text className='userItem-name' truncate={1}>{props.name}</Text>\n\t\t\t<Text className='userItem-text' truncate={1}>{props.text}</Text>\n\t\t</div>\n\t\t<Text className='userItem-date'>{props.date}</Text>\n\t</div>\n\t</>)\n}\n\n","import React from 'react';\nimport { useState, useEffect } from 'react';\nimport { Input } from '@chatui/core';\nimport axios from 'axios';\nimport { Divider } from 'antd';\nimport { nanoid } from 'nanoid';\n\nimport './userlist-theme.css'\nimport UserItem from './UserItem';\n\n\nexport default function(props) {\n  const [ filterText, setFilterText ] = useState('');\n  const [ users, setUsers ] = useState([]);\n  const [ isLoading, setIsLoading ] = useState(true);\n  const [ pageIndex, setpageIndex ] = useState(1);\n  const [ hasMore, setHasMore ] = useState(true);\n\n  useEffect(() => {\n    const fetchDate = async () => {\n      try {\n        setIsLoading(true);\n        const response = await axios.get(`/api/chat/list?all=false&pageIndex=${pageIndex}&pageSize=20&name=`);\n        if (response.data.rows.length > 0) {\n          setUsers((prevData) => [...prevData, ...response.data.rows]);\n          setpageIndex((prevPage) => prevPage + 1);\n        } else {\n          setHasMore(false);\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    }\n    \n    if (hasMore) {\n      fetchDate();\n    }\n  }, [ pageIndex, hasMore ]);\n\n  function filterUser (element, index, array) {\n    return element.nickname.includes(filterText);\n  }\n\n  let userList = users.filter(filterUser).map(\n    user => {\n      const _info = {\n        name: user.nickname,\n        img: user.localAvatar,\n        talker: user.talker\n      };\n      \n      return (<UserItem \n        Avatar={_info.img}\n        name={_info.name}\n        key={nanoid()}\n        onClick={()=>props.onClickMe(_info)}\n      />);\n    }\n  );\n  return (\n    <>\n      <Input  className='search-input' type='text' placeholder=\"搜索用户...\" onChange={(text)=>setFilterText(text)} />\n      <div style={{ height: '770px', overflow: 'auto' }}>\n        {userList}\n        {isLoading && <Divider className='Divider-end' plainp>Loading...</Divider>}\n        {!isLoading && !hasMore && filterText === '' && <Divider className='Divider-end' plain>已经到底啦 🤐</Divider>}\n      </div>\n    </>\n  );\n}","import React, { useEffect } from \"react\";\nimport { useState, useMemo, useRef } from \"react\";\nimport { IconButton, Text, Avatar, Time, Bubble } from '@chatui/core';\nimport InfiniteScroll from \"react-infinite-scroll-component\";\n\nimport dayjs from 'dayjs';\n\nimport \"./chatui-theme.css\"\n\nfunction ChatUiBar(props) {\n    return (<div className=\"ChatUiBar\">\n        <IconButton className=\"ChatUiBar--Btn\" icon=\"chevron-left\" onClick={props.onClickBack}/>\n        <Text className=\"ChatUiBar--Text\" truncate={1} >{props.title}</Text>\n        <IconButton className=\"ChatUiBar--Btn\" icon=\"ellipsis-h\" onClick={props.onClickMore} style={{visibility: props.visibility? 'hidden': 'visible'}}/>\n      </div>);\n}\n\nfunction MessageBubble(props) {\n  const isLeft = props.message.position === 'right'? false: true;\n  const userMessageContent = useMemo(() => props.renderMessageContent(props.message), [props.message]);\n\n  return (<div className=\"MessageBubble\">\n    {/* <Time date={props.message.createdAt}/> */}\n    <time className=\"Time\" dateTime={dayjs(props.message.createdAt).format()}>{dayjs(props.message.createdAt).format('YYYY年M月D日 HH:mm')}</time>\n    { userMessageContent.type === Bubble? \n      <div className={\"MessageBubble-content\" + (isLeft? \"-left\": \"-right\")}>\n        <div className=\"MessageBubble-content-Avatar\">\n          { isLeft && <Avatar className='MessageBubble-Avatar-left' src={props.message.user.avatar} size=\"md\" alt='无法加载头像'/>}\n        </div>\n        <div className={\"Bubble\"+ (isLeft? \"-left\": \"-right\")} >\n          <Text className={\"MessageBubble-Name\" + (isLeft? \"-left\": \"-right\")} truncate={1}>{props.message.user.name}</Text>\n          {userMessageContent}\n        </div>\n        <div className=\"MessageBubble-content-Avatar\">\n        { !isLeft && <Avatar className='MessageBubble-Avatar-right' src={props.message.user.avatar} size=\"md\" alt='无法加载头像'/>}\n        </div>\n      </div>: \n      userMessageContent\n    }\n  </div>)\n}\n\nfunction ChatMessageList(props) {\n\n  const scrollHeightRef = useRef(0);\n  const scrollElementRef = useRef(null);\n  const handleScroll = (event) => {\n    // console.log(event.srcElement.scrollTop);\n    if (event.srcElement.scrollTop === 0) {\n      // console.log(\"at bottom\");\n      scrollHeightRef.current = event.srcElement.scrollHeight;\n      scrollElementRef.current = event.srcElement;\n      // console.log(scrollHeightRef.current);\n      // console.log(scrollElementRef.current.scrollHeight);\n      props.atBottom && props.atBottom();\n    } else {\n      scrollHeightRef.current = 0;\n      scrollElementRef.current = null;\n    }\n  };\n\n  function fetchMoreData(){\n    // console.log(\"next\");\n    props.next();\n  }\n\n  useEffect(() => {\n    if (scrollHeightRef.current !== 0 && scrollElementRef.current) {\n      /* 回滚到原来的位置 */\n      scrollElementRef.current.scrollTop = -(scrollElementRef.current.scrollHeight - scrollHeightRef.current);\n      scrollHeightRef.current = 0;\n      scrollElementRef.current = null;\n    }\n  }, [props.messages]);\n\n  return (<div id=\"scrollableDiv\">\n    <InfiniteScroll \n      scrollableTarget=\"scrollableDiv\"\n      dataLength={props.messages.length}\n      // next={props.next}\n      next={fetchMoreData}\n      hasMore={props.hasMore}\n      inverse={true}\n      scrollThreshold={1}\n      onScroll={handleScroll}\n      // style={{ display: 'flex', flexDirection: 'column-reverse' }} //To put endMessage and loader to the top.\n      // style={{overflow: 'auto', overflowX: 'hidden'}}\n    >\n      {\n        props.messages.map((msg) => {\n          // console.log(\"props.messages.map\");\n          return (<MessageBubble\n                    message={msg}\n                    renderMessageContent={props.renderMessageContent}\n                    key={msg.createdAt}\n                  />);\n        })\n      }\n    </InfiniteScroll>\n  </div>\n  );\n}\n\nexport default function ChatUi(props) {\n\n\n  return (<div className=\"ChatUi\">\n    <ChatUiBar \n      title={props.name}\n      onClickMore={props.onClickMore}\n      onClickBack={props.onClickBack}\n      visibility={props.moreVisibility}\n    />\n    <ChatMessageList\n      messages={props.messages}\n      next={props.fetchMoreData}\n      hasMore={props.hasMore} \n      renderMessageContent={props.renderMessageContent}\n      atBottom={props.atBottom}\n      />\n  </div>)\n}","import React from \"react\";\nimport { useState } from \"react\";\n\nexport default function useChatMessages(initValue) {\n    const [ messages, setMessages ] = useState(initValue);\n\n    const prependMsgs = (preMsgs) => {\n        // setMessages(messages.concat(preMsgs))\n        setMessages(preMsgs.concat(messages));\n    }\n    const appendMsgs = (appMsgs) => {\n        setMessages(messages.concat(appMsgs));\n    }\n\n    return {\n        messages: messages,\n        prependMsgs: prependMsgs,\n        appendMsgs: appendMsgs,\n      }\n}","import react from \"react\";\nimport { Bubble, Video, SystemMessage, Text } from \"@chatui/core\";\nimport { Image } from 'antd';\nimport parser from 'xml2js';\n\nexport default function renderMessageContent(msg)\n{\n\tswitch (msg.type) {\n\t\tcase '1': //文本\n\t\t\treturn <Bubble content={msg.content.content} id={msg._id}/>;\n\t\t\t// return (<Bubble id={msg._id}>\n\t\t\t// \t<div style={{wordWrap: 'break-word', width: '100%', overflowX: 'hidden'}}>\n\t\t\t// \t\t<text>{msg.content.content}</text>\n\t\t\t// \t</div>\n\t\t\t// </Bubble>);\n\t\tcase '3': //图片\n\t\t\treturn (\n\t\t\t\t<Bubble type=\"image\" id={msg._id}>\n\t\t\t\t\t<Image src={msg.content.mediaSourcePath || msg.content.mediaBCKPath || msg.content.mediaPath} \n\t\t\t\t\t\talt=\"图片\" \n\t\t\t\t\t/>\n\t\t\t\t</Bubble>\n\t\t\t);\n\t\tcase '34': //语音\n\t\t\treturn (<Bubble id={msg._id}>\n\t\t\t\t<audio controls src={msg.content.mediaPath} />\n\t\t\t</Bubble>);\n\t\tcase \"43\": // 视频\n\t\t\treturn (<Bubble type=\"video\" id={msg._id}>\n\t\t\t\t<Video src={ msg.content.mediaPath } />\n\t\t\t\t</Bubble>);\n\t\tcase \"47\": // 大表情\n\t\t\treturn (<Bubble type=\"image\" id={msg._id}>\n\t\t\t\t<img src={msg.content.emojiInfo.cdnUrl} alt=\"表情无法加载\" />\n\t\t\t\t</Bubble>);\n\t\tcase \"48\":\n\t\t\treturn <Bubble content={\"[位置消息😂]\"} id={msg._id}/>;\n\t\tcase \"49\":\n\t\t\t// 卡片信息\n\t\t\treturn <Bubble content={\"[卡片信息]\"} id={msg._id}/>;\n\t\tcase \"10000\":\n\t\t\t// 系统消息\n\t\t\treturn <div style={{ margin: \"0 auto\" }} id={msg._id} ><SystemMessage content={msg.content.content} /></div>;\n\t\tcase \"268445456\":\n\t\t\t// 撤回消息通知\n\t\t\treturn <div style={{ margin: \"0 auto\" }} id={msg._id}><SystemMessage content={msg.content.content} /></div>;\n\t\tcase \"436207665\":\n\t\t\t// 微信红包\n\t\t\treturn \"text\";\n\t\tcase \"419430449\":\n\t\t\t// 微信转账\n\t\t\treturn \"text\";\n\t\tcase \"1090519089\":\n\t\t\t// 文件\n\t\t\treturn \"\";\n\t\tcase \"318767153\":\n\t\t\t// 公众号推送\n\t\t\treturn \"text\";\n\t\tcase \"822083633\": //消息引用\n\t\t\t// console.log(\"parseString ++\", msg.content.msgId);\n\t\t\tlet finalmsg = undefined;\n\t\t\tparser.parseString(msg.content.content, (error, result) => {\n\t\t\t\tif (!error) {\n\t\t\t\t\t// console.log(result);\n\t\t\t\t\tlet refermsg = result.msg.appmsg[0].refermsg[0].displayname[0] + \": \";\n\t\t\t\t\tif (result.msg.appmsg[0].refermsg[0].type[0] === '1') { //引用文字\n\t\t\t\t\t\trefermsg += result.msg.appmsg[0].refermsg[0].content[0];\n\t\t\t\t\t} else if (result.msg.appmsg[0].refermsg[0].type[0] === '43') { //引用视频\n\t\t\t\t\t\trefermsg += '[视频]';\n\t\t\t\t\t} else if (result.msg.appmsg[0].refermsg[0].type[0] === '3') { //引用图片\n\t\t\t\t\t\trefermsg += '[图片]';\n\t\t\t\t\t} else if (result.msg.appmsg[0].refermsg[0].type[0] === '34') { //引用语音\n\t\t\t\t\t\trefermsg += '[语音]';\n\t\t\t\t\t} else if (result.msg.appmsg[0].refermsg[0].type[0] === '49') { //引用了引用\n\t\t\t\t\t\tlet reReferMsg = undefined;\n\t\t\t\t\t\tparser.parseString(result.msg.appmsg[0].refermsg[0].content[0], (error, result) => {\n\t\t\t\t\t\t\tif (!error) {\n\t\t\t\t\t\t\t\treReferMsg = result.msg.appmsg[0].title? result.msg.appmsg[0].title[0]: \"未知引用的引用\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treReferMsg = \"引用的引用xml解析失败\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\trefermsg = '[引用]\\n' + refermsg;\n\t\t\t\t\t\trefermsg += reReferMsg;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trefermsg += \"需要处理的引用类型\" + result.msg.appmsg[0].refermsg[0].type[0];\n\t\t\t\t\t}\n\t\t\t\t\tlet appmsg = result.msg.appmsg[0].title[0];\n\t\t\t\t\tfinalmsg = (<Bubble id={msg._id}>\n\t\t\t\t\t\t<Text breakWord>{refermsg}</Text>\n\t\t\t\t\t\t<Text>----</Text>\n\t\t\t\t\t\t<Text>{appmsg}</Text>\n\t\t\t\t\t</Bubble>);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('XML parsing error: ', error);\n\t\t\t\t\tfinalmsg = (<Bubble type='text' content='XML parsing error: {error}'/>);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t// console.log(\"parseString --\");\n\t\t\treturn finalmsg;\n\t\tcase \"922746929\": //拍一拍\n\t\tdefault:\n\t\t\tconsole.log(msg);\n\t\t\treturn <Bubble content={`未知类型: ${msg.type}`} id={msg._id}/>\n\t}\n}","import React, { useRef } from \"react\";\nimport { useState, useEffect } from \"react\";\nimport axios from 'axios';\n\n\nimport ChatUi from \"./ChatUi\";\nimport useChatMessages from \"./hooks/useChatMessages\";\nimport renderMessageContent from \"./RenderMessage\";\n\nexport default function WeChatSearch({info, createTime, onClickBack}) {\n\t\n  const { messages, prependMsgs, appendMsgs } = useChatMessages([]);\n  const [ pageIndex, setPageIndex ] = useState(1);\n  const [ isLoading, setIsLoading ] = useState(false);\n  const [ isHasMore, setIsHasMore ] = useState(true);\n  const [ nextPageIndex, setNextPageIndex ] = useState(1);\n  const itemRef = useRef(null);\n  const messageUrl = `api/chat/detailat?talker=${info.talker}&createTime=${createTime}&direction=prev&pageIndex=${pageIndex}&pageSize=10`;\n\n  useEffect(() => {\n    setIsLoading(true);\n    axios.get(messageUrl)\n    .then(body=>{\n      let msgs = [];\n      body.data.rows.forEach(\n        row => {\n          msgs.unshift({\n            _id: row.msgSvrId + Math.floor(Math.random() * 9999),\n            type: row.type + \"\",\n            content: row,\n            position: row.isSend === 1? \"right\": \"left\",\n            user: {\n              avatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n              name: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n            },\n            hasTime: true,\n            createdAt: row.createTime\n          });\n        }\n      );\n\n      prependMsgs(msgs);\n      setIsLoading(false);\n    }).catch(() => {\n      setIsLoading(false);\n    });\n  }, [messageUrl])\n\n  const nextMessageUrl = `api/chat/detailat?talker=${info.talker}&createTime=${createTime}&direction=next&pageIndex=${nextPageIndex}&pageSize=10`;\n\n  useEffect(() => {\n    setIsLoading(true);\n    axios.get(nextMessageUrl)\n    .then(body=>{\n      let msgs = [];\n      body.data.rows.forEach(\n        row => {\n          msgs.push({\n            _id: row.msgSvrId + Math.floor(Math.random() * 9999),\n            type: row.type + \"\",\n            content: row,\n            position: row.isSend === 1? \"right\": \"left\",\n            user: {\n              avatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n              name: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n            },\n            hasTime: true,\n            createdAt: row.createTime\n          });\n        }\n      );\n      \n      appendMsgs(msgs);\n      setIsLoading(false);\n    }).catch(() => {\n      setIsLoading(false);\n    });\n  }, [nextMessageUrl])\n\n  useEffect(() => {\n    setIsLoading(true);\n    const prevMessageUrl = `api/chat/detailat?talker=${info.talker}&createTime=${createTime}&direction=prev&pageIndex=${pageIndex}&pageSize=10`;\n    const nextMessageUrl = `api/chat/detailat?talker=${info.talker}&createTime=${createTime}&direction=next&pageIndex=${pageIndex}&pageSize=10`;\n\n    const fetchData = async () => {\n      try {\n        const [ prevResponse, nextResponse ] = await Promise.all([\n          axios.get(prevMessageUrl),\n          axios.get(nextMessageUrl)\n        ]);\n\n        const prevData = prevResponse.data;\n        const nextData = nextResponse.data;\n        let msgs = [];\n        if (prevData) {\n          prevData.rows.forEach(\n            row => {\n              msgs.unshift({\n                _id: row.msgSvrId + Math.floor(Math.random() * 9999),\n                type: row.type + \"\",\n                content: row,\n                position: row.isSend === 1? \"right\": \"left\",\n                user: {\n                  avatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n                  name: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n                },\n                hasTime: true,\n                createdAt: row.createTime\n              });\n            }\n          );\n        }\n\n        if (nextData) {\n          const index = msgs.length;\n          nextData.rows.forEach(\n            row => {\n              msgs.push({\n                _id: row.msgSvrId + Math.floor(Math.random() * 9999),\n                type: row.type + \"\",\n                content: row,\n                position: row.isSend === 1? \"right\": \"left\",\n                user: {\n                  avatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n                  name: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n                },\n                hasTime: true,\n                createdAt: row.createTime\n              });\n            }\n          );\n          itemRef.current = msgs[index]._id;\n          // console.log(msgs);\n          appendMsgs(msgs);\n        }\n        \n        setIsLoading(false);\n      } catch (error) {\n        console.error('Error fetching data:', error);\n        setIsLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [])\n\n  useEffect(() => {\n    const elem = document.getElementById(itemRef.current);\n    if (elem) {\n      let currentNode = elem;\n      while (currentNode.parentNode) {\n        currentNode = currentNode.parentNode;\n        if (currentNode.className === 'MessageBubble') {\n          currentNode.scrollIntoView();\n          itemRef.current = null;\n          break;\n        }\n      }\n    }\n  }, [messages]);\n\n\tconst fetchPrevData = () => {\n\t\tif (!isLoading) {\n\t\t\tsetPageIndex(pageIndex + 1);\n\t\t}\n\t}\n\n  const fetchNextData = () => {\n    if (!isLoading) {\n\t\t\tsetNextPageIndex(nextPageIndex + 1);\n\t\t}\n  }\n\t\n\treturn (<>\n    <ChatUi\n      name={info.name} \n      messages={messages}\n      fetchMoreData={fetchPrevData}\n      hasMore={isHasMore && !isLoading}\n      // hasMore={false}\n      renderMessageContent={renderMessageContent}\n      onClickBack={onClickBack}\n      moreVisibility='hidden'\n      atBottom={fetchNextData}\n      />\n    </>);\n}","import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport './CalendarChoose.css';\nimport { Spin, Calendar } from 'antd';\nimport { IconButton, Text} from '@chatui/core'\n\nimport locale from 'antd/es/date-picker/locale/zh_CN';\nimport 'dayjs/locale/zh-cn';\n\nimport dayjs from 'dayjs';\nimport utc from 'dayjs/plugin/utc';\nimport timezone from 'dayjs/plugin/timezone';\n\nimport WeChatSearch from './WeChatSearch';\n\ndayjs.extend(utc);\ndayjs.extend(timezone);\ndayjs.tz.setDefault();\n\nconst CalendarBar = ({onClickBack}) => {\n  return (<div className=\"CalendarBar\">\n      <IconButton className=\"CalendarBar--Btn\" icon=\"chevron-left\" onClick={onClickBack}/>\n      <Text className=\"CalendarBar--Text\" truncate={1} >按照日期查找</Text>\n      <IconButton className=\"CalendarBar--Btn\" icon=\"chevron-left\" style={{visibility: 'hidden'}}/>\n    </div>);\n}\n\nconst CalendarLoading = () => {\n  return (\n  <div className='CalendarLoading'>\n    <Spin tip=\"加载中...\" size=\"large\">\n      <div className=\"content\" />\n    </Spin>\n  </div>);\n}\n\nconst CalendarChoose = ({info, onClickBack}) => {\n  const [ messageDate, setMessageDate ] = useState([]);\n  const [ isLoading, setIsLoading ] = useState(true);\n  const [ isCalendarChoose, setIsCalendarChoose ] = useState(true)\n  const createTimeRef = useRef(1);\n  const selectTimeRef = useRef(null);\n  // console.log(dayjs('2023-7-29').tz('Asia/Shanghai'));\n  // console.log(dayjs('2023-7-29'));\n  const disabledDate = (current) => {\n    // console.log(current);\n    for (let i=0; i<messageDate.length; i++) {\n      if (current.isSame(dayjs(messageDate[i]))) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  useEffect(() => {\n    axios.get(`/api/chat/msgdate?talker=${info.talker}`)\n    .then(body=>{\n      setMessageDate(body.data.date);\n      setIsLoading(false);\n    }).catch();\n  }, [ info.talker ]);\n\n  const CalendarElement = (<> \n    <CalendarBar onClickBack={onClickBack}/>\n    {isLoading? <CalendarLoading />:\n    <Calendar \n      fullscreen={false}\n      disabledDate={disabledDate}\n      locale={locale}\n      validRange={messageDate.length > 0? [dayjs(messageDate[messageDate.length-1]), dayjs(messageDate[0])]: undefined}\n      defaultValue={selectTimeRef.current? selectTimeRef.current: messageDate.length > 0? dayjs(messageDate[0]): undefined}\n      onSelect={(date, info) => {\n        // console.log(date);\n        // console.log(info);\n        if (info.source === 'date') {\n          createTimeRef.current = date.valueOf(); \n          setIsCalendarChoose(false);\n          selectTimeRef.current = date;\n        }\n      }}\n    />}\n  </>\n  );\n  return ( isCalendarChoose? CalendarElement: <WeChatSearch info={info} createTime={createTimeRef.current} onClickBack={()=>setIsCalendarChoose(true)}/>);\n};\nexport default CalendarChoose;","import React, { useEffect, useState, useMemo } from 'react';\nimport { IconButton, Text, Icon } from '@chatui/core';\nimport { Image, FloatButton, Tag } from 'antd';\nimport { nanoid } from 'nanoid';\nimport axios from 'axios';\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport useChatMessages from \"./hooks/useChatMessages\";\n\nimport './imageui-theme.css'\n\n\n\nconst ImagesUIBar = ({onClickBack}) => {\n  return (<div className=\"ImagesUIBar\">\n      <IconButton className=\"ImagesUIBar--Btn\" icon=\"chevron-left\" onClick={onClickBack}/>\n      <Text className=\"ImagesUIBar--Text\" truncate={1} >图片及视频</Text>\n      <IconButton className=\"ImagesUIBar--Btn\" icon=\"chevron-left\" style={{visibility: 'hidden'}}/>\n    </div>);\n}\n\nfunction ImageItem({info}) {\n  const fn = (info) => {\n    return(\n      <div className=\"preview-ImageItem\">\n        <Image className='preview-ImageItem-img' \n          width={96} height={128} src={info.type === 'image'? info.src: info.preview} loading='lazy'\n        />\n        <Icon className='preview-ImageItem-icon' type={info.type === 'image'? 'image': 'play-circle'} />\n      </div>\n    );\n  }\n  const comp = useMemo(() => fn(info), [info]);\n  \n  return comp;\n}\n\nexport default function ImagesUI({talker, onClickBack}) {\n  \n  const { messages, prependMsgs, appendMsgs } = useChatMessages([]);\n  const [ pageIndex, setPageIndex ] = useState(1);\n  const [ isLoading, setIsLoading ] = useState(false);\n  const [ isHasMore, setIsHasMore ] = useState(true);\n  \n  const mediaUrl = `apt/media/list?talker=${talker}&pageIndex=${pageIndex}&pageSize=28`;\n\n  useEffect(() => {\n    setIsLoading(true);\n    axios.get(mediaUrl)\n    .then(body=>{\n      let msgs = [];\n      body.data.rows.forEach(\n        row => {\n          msgs.push({\n            type: row.type === 3? 'image': 'video',\n            preview: row.type === 3? row.mediaPath: row.imgPath,\n            src: row.type === 3? (row.mediaSourcePath || row.mediaBCKPath || row.mediaPath): row.mediaPath,\n            createdAt: row.createTime,\n          });\n        }\n      );\n      \n      if (msgs.length === 0) {\n        setIsHasMore(false);\n      } else {\n        appendMsgs(msgs);\n      }\n      setIsLoading(false);\n    }).catch(() => {\n      setIsLoading(false);\n    });\n  }, [mediaUrl])\n\n  const fetchMore = () => {\n    if (!isLoading) {\n      setPageIndex(pageIndex+1);\n    }\n  };\n  \n  return (\n  <>\n    <ImagesUIBar onClickBack={onClickBack}/>\n    <InfiniteScroll\n      className='ImageUI--InfiniteScroll'\n      dataLength={messages.length}\n      hasMore={isHasMore}\n      next={fetchMore}\n      height={770}\n      // loader={<h4>Loading...</h4>}\n      endMessage={<div className='endMessage-div'><p>- 已经到底啦 -</p></div>}\n    >\n      <div className='ImageUI-list'>\n        <Image.PreviewGroup\n          preview={{\n            onChange: (current, prev) => console.log(`current index: ${current}, prev index: ${prev}`),\n            imageRender: (originalNode, info) => {\n              if (messages.length === 0) {\n                return originalNode;\n              }\n\n              if (messages[info.current].type === 'image') {\n                // return (<img src={messages[info.current].src}/>);\n                return originalNode;\n              }\n              \n              return (<video className='video_view' height='100%' width='100%' controls\n                src={messages[info.current].src}\n              />);\n              },\n            toolbarRender: (originalNode, info) =>{\n              return (messages[info.current].type == 'image')? originalNode: null;\n            },\n            onVisibleChange: (visible, prevVisible, current) => {\n              if (visible === false && prevVisible === true && messages[current].type === 'video') {\n                const vid = document.getElementsByClassName(\"video_view\");\n                console.log(vid);\n                vid[0].pause();\n              }\n              console.log('visible', visible, 'prevVisible', prevVisible, 'current', current);\n            },\n            \n          }}\n        >\n          {messages.map((img) => { return <ImageItem info={img} key={nanoid()}/>})}\n        </ Image.PreviewGroup>\n        \n      </div>\n      <FloatButton.BackTop />\n    </ InfiniteScroll>\n  </>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport Chat, { Input, Button, Icon, Text, Flex, Avatar } from '@chatui/core';\nimport InfiniteScroll from \"react-infinite-scroll-component\";\nimport axios from 'axios';\nimport parser from 'xml2js';\n\n\nimport './searchui-theme.css'\nimport UserItem from './UserItem';\nimport CalendarChoose from './Calendar';\nimport ImagesUI from './ImagesUi';\nimport WeChatSearch from './WeChatSearch';\n\nfunction timeStampToDate(stamp) {\n\tconst date = new Date(stamp); // 传入毫秒时间戳创建 Date 对象\n\n\t// 使用 Date 对象的方法获取年、月、日等信息\n\tconst year = date.getFullYear();\n\tconst month = date.getMonth() + 1; // 月份从 0 开始，所以要加 1\n\tconst day = date.getDate();\n\tconst hours = date.getHours();\n\tconst minutes = date.getMinutes();\n\tconst seconds = date.getSeconds();\n\n\t// 可以根据需要将这些时间部分格式化成字符串\n\t// const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n\t// console.log(formattedDate);\n\treturn `${year}-${month}-${day}`;\n}\n\nfunction SearchBar(props) {\n\tlet timer;\n\tfunction onChangeInput(text) {\n\t\tclearTimeout(timer);\n\t\ttimer = setTimeout(() => {\n\t\t\tconsole.log(text);\n\t\t\tprops.onChangeKeyWord(text);\n\t\t}, 300);\n\t}\n\treturn (<>\n\t\t<div className=\"searchui--bar\" >\n\t\t\t<Icon className=\"searchui--bar--icon\" type=\"search\" />\n\t\t\t<Input className=\"searchui--bar--input\" placeholder=\"搜索\" onChange={onChangeInput}/>\n\t\t\t<Button className=\"searchui--bar--button\" onClick={()=>props.onClickButton('Back')}>取消</Button>\n\t\t</div>\n\t</>)\n}\n\nfunction SearchOption(props) {\n\treturn (<>\n\t\t<Flex className=\"searchui--content\" center={true}>\n\t\t\t<Text className=\"searchui-text\" >搜索指定内容</Text>\n\t\t</Flex>\n\t\t<Flex className=\"searchui--button\" center={true}>\n\t\t\t<table className=\"searchui--table\">\n\t\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><Button onClick={()=>props.onClickButton('Date')}>日期</Button></td>\n\t\t\t\t\t<td><Button onClick={()=>props.onClickButton('Img')}>图片及视频</Button></td>\n\t\t\t\t\t<td><Button>文件</Button></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><Button>链接</Button></td>\n\t\t\t\t\t<td><Button disabled>音乐</Button></td>\n\t\t\t\t\t<td><Button disabled>交易</Button></td>\n\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</Flex>\n\t</>)\n}\n\nfunction UserItemList(props) {\n\n\tconst [ items, setItems ] = useState([]);\n\tconst [ isHasMore, setIsHasMore ] = useState(true);\n\t// const [ createTime, setCreateTime ] = useState(Date.now());\n\t\n\n\tuseEffect(() => {\n\t\tsetItems([]);\n\t\tconsole.log('useEffect');\n\t\tsetIsHasMore(true)\n\t\tfetchMoreData(false)\n\t}, [ props.keyWord ]);\n\n\tfunction onClikItem(item) {\n\t\tconsole.log(item)\n\t\tprops.onClikItem(item)\n\t}\n\n\tfunction fetchMoreData(isconcat) {\n\t\tlet createTime = (isconcat == false)? Date.now(): items.length > 0? items[items.length-1].key: Date.now();\n\t\tconsole.log(\"createTime: \", createTime)\n\t\taxios.get(`api/chat/detailkw?talker=${props.user}&createTime=${createTime}&pageSize=20&keyWord=${props.keyWord}`)\n    .then(body=>{\n\t\t\tif (body.data.total === 0) {\n\t\t\t\tsetIsHasMore(false);\n\t\t\t\tconsole.log(\"setIsHasMore(false);\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet itemlist = [];\n\t\t\tbody.data.rows.forEach(\n\t\t\t\trow => {\n\t\t\t\t\titemlist.push({\n\t\t\t\t\t\ttext: row.content,\n\t\t\t\t\t\tdate: timeStampToDate(row.createTime),\n\t\t\t\t\t\tAvatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n\t\t\t\t\t\tname: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n\t\t\t\t\t\tkey: row.createTime,\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t// console.log(items);\n\t\t\tsetItems(isconcat? items.concat(itemlist): itemlist);\n\t\t\t// setItems(itemlist);\n    }).catch();\n\t}\n\n\treturn (\n\t<div className='keyWord--InfiniteScroll--outside'>\n\t<InfiniteScroll\n\tclassName='keyWord--InfiniteScroll'\n\t\tdataLength={items.length}\n\t\thasMore={isHasMore}\n\t\tnext={()=>{console.log(\"fetchMoreData(true)\");fetchMoreData(true)}}\n\t\theight={770}\n\t\t// loader={<h4>Loading...</h4>}\n\t>\n\t\t<div className='keyWord--InfiniteScroll--div'>\n\t\t{items.map((item) => {\n\t\t\treturn (<UserItem\n\t\t\t\tonClick={()=>onClikItem(item)}\n\t\t\t\tAvatar={item.Avatar}\n\t\t\t\tname={item.name}\n\t\t\t\ttext={item.text}\n\t\t\t\tdate={item.date}\n\t\t\t\tkey={item.key}\n\t\t\t\t/>)\n\t\t})}\n\t\t</div>\n\t</InfiniteScroll>\n\t</div>)\n}\n\nexport default function SearchUi(props) {\n\n\tconst [currentComponent, setCurrentComponent] = useState('Main');\n\tconst [ keyWord, setKeyWord ] = useState('');\n\tconst [ isSearchBar, setIsSearchBar ] = useState(true);\n\tconst createTimeRef = useRef(0);\n\n\tfunction onClickButton(btn) {\n\t\tswitch (btn) {\n\t\t\tcase 'Back': props.onClickBack();\n\t\t\t\tbreak;\n\t\t\tcase 'Date': setCurrentComponent('Date');\n\t\t\t\tbreak;\n\t\t\tcase 'Img': setCurrentComponent('Img');\n\t\t\t\tbreak;\n\t\t\tdefault: console.log('unknown click ', btn);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tconst onClikItem = (item) => {\n\t\tcreateTimeRef.current = item.key-1;\n\t\tsetIsSearchBar(false);\n\t};\n\tconst SearchBarComponent = (<>\n\t\t<SearchBar onChangeKeyWord={(kw)=>{setKeyWord(kw);}} onClickButton={onClickButton}/>\n\t\t{ keyWord === \"\" ? <SearchOption onClickButton={onClickButton} />: <UserItemList keyWord={keyWord} user={props.info.talker} onClikItem={onClikItem}/>}\n\t</>);\n\n\tfunction renderComponent() {\n\t\tswitch(currentComponent) {\n\t\t\tcase 'Main':\n\t\t\t\treturn (<>\n\t\t\t\t\t{ isSearchBar ? SearchBarComponent: <WeChatSearch info={props.info} createTime={createTimeRef.current} onClickBack={()=>setIsSearchBar(true)}/>\n\t\t\t\t}\n\t\t\t\t</>);\n\t\t\tcase 'Date':\n\t\t\t\treturn (<CalendarChoose info={props.info} onClickBack={()=>setCurrentComponent('Main')}/>);\n\t\t\tcase 'Img':\n\t\t\t\treturn (<ImagesUI talker={props.info.talker} onClickBack={()=>setCurrentComponent('Main')}/>);\n\t\t\tdefault:\n\t\t\t\treturn (<div>unknown</div>);\n\t\t}\n\t}\n  return (<>\n\t\t{renderComponent()}\n\t</>)\n}","import React from \"react\";\nimport { useState, useEffect } from \"react\";\nimport axios from 'axios';\n\n\nimport ChatUi from \"./ChatUi\";\nimport useChatMessages from \"./hooks/useChatMessages\";\nimport SearchUi from './SearchUi';\nimport renderMessageContent from \"./RenderMessage\";\n\nexport default function WeChatDialog(props) {\n\t\n  const { messages, prependMsgs, appendMsgs } = useChatMessages([]);\n  const [ pageIndex, setPageIndex ] = useState(1);\n  const [ isLoading, setIsLoading ] = useState(false);\n  const [ isHasMore, setIsHasMore ] = useState(true);\n  const [ isSearch, setIsSearch ] = useState(false);\n  \n  const messageUrl = `api/chat/detail?talker=${props.info.talker}&pageIndex=${pageIndex}&pageSize=10`;\n\n  useEffect(() => {\n    setIsLoading(true);\n    axios.get(messageUrl)\n    .then(body=>{\n      let msgs = [];\n      body.data.rows.forEach(\n        row => {\n          msgs.unshift({\n            _id: row.msgSvrId + Math.floor(Math.random() * 9999),\n            type: row.type + \"\",\n            content: row,\n            position: row.isSend === 1? \"right\": \"left\",\n            user: {\n              avatar: row.userInfo.reserved2 !== \"\" ? row.userInfo.reserved2 : row.userInfo.localAvatar,\n              name: row.userInfo.conRemark? row.userInfo.conRemark: row.userInfo.nickName,\n            },\n            hasTime: true,\n            createdAt: row.createTime\n          });\n        }\n      );\n\n      prependMsgs(msgs);\n      setIsLoading(false);\n    }).catch(() => {\n      setIsLoading(false);\n    });\n  }, [messageUrl])\n\n\tconst fetchMoreData = () => {\n\t\tif (!isLoading) {\n\t\t\tsetPageIndex(pageIndex + 1);\n\t\t}\n\t}\n\n\t\n\treturn (<>\n    {isSearch?\n    <SearchUi info={props.info} onClickBack={()=>setIsSearch(false)}/>:\n    <ChatUi\n      name={props.info.name} \n      messages={messages}\n      fetchMoreData={fetchMoreData}\n      hasMore={isHasMore && !isLoading}\n      // hasMore={false}\n      renderMessageContent={renderMessageContent}\n      onClickBack={props.onClickBack}\n      onClickMore={()=>setIsSearch(true)}\n      />}\n    </>);\n}","import React from 'react';\nimport { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport '@chatui/core/dist/index.css';\n\nimport UserList from './components/UserList';\nimport WeChatDialog from './components/WeChatDialog';\n// import \"./styles.css\";\n\nexport default function App() {\n  const [ isChat, setIsChat ] = useState(false);\n  const [ userInfo, setUserInfo ] = useState({});\n\n  function clickUser(info) {\n    console.log(info);\n    setUserInfo(info);\n    setIsChat(true);\n  }\n\n  function clickBack() {\n    setIsChat(false);\n  }\n\n  return (\n    <div className='Main-div'>\n      <div className='Main-sub-div'>\n        {isChat? <WeChatDialog info={userInfo} onClickBack={clickBack} />: <UserList onClickMe={clickUser}/>}\n      </div>\n    </div>\n  );\n}","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport \"./styles.css\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}